# Replace the self-signed Remote Desktop Certificate with an PKI Certificate from your internal CA

## Method 1

### Get the current Thumbprint of the certificate
```
Get-WmiObject "Win32_TSGeneralSetting" -ComputerName "<Server Name>" -Namespace root\cimv2\terminalservices -Filter "TerminalName='RDP-tcp'"
```
<br>

### Replace the exisitng certificate with new one

#### Assign 'Terminal Services' Settings to a variable
```
$TSGeneralSetting = Get-WmiObject "Win32_TSGeneralSetting" -ComputerName "<Server Name>" -Namespace root\cimv2\terminalservices -Filter "TerminalName='RDP-tcp'"
```

#### Assign the Thumbprint (SHA1 Hash) of the NEW Certificate to another variable
##### Windows Server 2019 and above
```
$Hash = ("<hash of new certificate>").ToUpper()
```
##### prior to Windows Server 2019
```
$Hash = ("<hash of new certificate>").ToUpper().Replace(" ","")
```
#### Replace the 'SSLCertificateSHA1Hash' in 'Terminal Services' Settings with new Thumbprint
```
$TSGeneralSetting.SSLCertificateSHA1Hash = $Hash
```
#### Apply the changes
```
$TSGeneralSetting.put()
```
<br>

## Method 2

```
wmic /namespace:\\root\cimv2\TerminalServices PATH Win32_TSGeneralSetting Set SSLCertificateSHA1Hash="<hash of new certificate>"
```



